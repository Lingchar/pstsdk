[
  {
    "Id": "480458",
    "ThreadId": "223547",
    "Html": "<p>Hi everyone,</p>\r\n<p>I'm working on porting pstsdk to iOS and am having structure alignment/padding issues that seem to be different than what was found during the Mac port. &nbsp;I'm looking for assistance on the right way to fix some of these in disk.h. &nbsp;It almost looks like the ms_struct attribute isn't helping me all that much on this platform. &nbsp;Can anyone give me some guidance on the first couple to get me going?&nbsp;</p>\r\n<p>A couple of examples:</p>\r\n<p><span style=\"white-space:pre\"> </span>Windows: &nbsp;</p>\r\n<p><span style=\"white-space:pre\"> </span>bbt_leaf_entry&lt;ulong&gt;<span style=\"white-space:pre\"> </span>=&gt;<span style=\"white-space:pre\"> </span>Size = 12, size at offset 8, ref_count at offset 10</p>\r\n<p><span style=\"white-space:pre\"> </span>bbt_leaf_entry&lt;ulonglong&gt;<span style=\"white-space:pre\"> </span><span>&nbsp;</span>=&gt;<span> </span>Size = 24, size at offset 16, ref_count at offset 18</p>\r\n<p><span style=\"white-space:pre\"> </span>sub_leaf_entry&lt;ulong&gt; <span style=\"white-space:pre\"> </span>=&gt; &nbsp; Size = 12, data at offset 4, sub at offset 8</p>\r\n<p><span style=\"white-space:pre\"> sub_leaf_entry&lt;ulong</span>long<span style=\"white-space:pre\">&gt; \t=&gt; &nbsp; Size = </span>24<span style=\"white-space:pre\">, data at offset </span>8<span style=\"white-space:pre\">, sub at offset </span>16</p>\r\n<p><span style=\"white-space:pre\"> </span>iOS:</p>\r\n<p><span style=\"white-space:pre\"> </span>bbt_leaf_entry&lt;ulong&gt;<span> <span style=\"white-space:pre\"> </span></span>=&gt;<span> </span>Size = 12, size at offset 8, ref_count at offset 10</p>\r\n<p><span>&nbsp;</span><span style=\"white-space:pre\"> </span>bbt_leaf_entry&lt;ulonglong&gt;<span> </span><span>&nbsp;<span style=\"white-space:pre\"> </span></span>=&gt;<span>&nbsp;</span>Size = <span style=\"color:#ff0000\">20</span>, size at offset 16, ref_count at offset 18 &nbsp;<span style=\"color:#ff0000\">(Four extra bytes at the end of the struct)</span></p>\r\n<p><span style=\"white-space:pre\"> </span>sub_leaf_entry&lt;ulong&gt;&nbsp;<span> <span style=\"white-space:pre\"> </span></span>=&gt; &nbsp; Size = 12, data at offset 4, sub at offset 8</p>\r\n<p><span><span style=\"white-space:pre\"> </span>sub_leaf_entry&lt;ulong</span>long<span>&gt; <span style=\"white-space:pre\"> </span>=&gt; &nbsp; Size = </span><span style=\"color:#ff0000\">20</span><span>, data at offset <span style=\"color:#ff0000\">4</span></span><span>, sub at offset </span><span style=\"color:#ff0000\">12 &nbsp;(data did NOT get padded like it did on Windows)</span></p>\r\n<p>&nbsp;</p>\r\n<p>Thanks in advance for your assistance.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks,</p>\r\n<p>Mike</p>",
    "PostedDate": "2010-08-13T20:53:35.17-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "480488",
    "ThreadId": "223547",
    "Html": "<p>If anyone ever wonders again why it's a bad idea to have structs defined to match on disk layouts and just blast bits between disk and memory should look at this project. It has it's advantages (namely, it's the simplest solution to implement and understand, and it's what most people want) but it simply doesn't scale. I'd do things differently if I had to do it again.</p>\r\n<p>I'm a little surprised that you're having alignment issues on iOS, I would have figured GCC alignment there would be identical to OSX. Hmph.</p>\r\n<p>I'll have to think about a long term solution. In the meantime if I were you I'd probably patch up things with #ifdef IOS specific padding members, or try to figure out the magic incantation to get their version of the compiler to layout structs the same as on OSX (which others have spent time getting to align the same as windows).</p>\r\n<p>Also, if you do run into any runtime issues that you can trace back to layout differences let me know - I want the set of static_asserts to be broad enough that once you can get it to compile on another platform, everything works.</p>",
    "PostedDate": "2010-08-14T00:46:04.683-07:00",
    "UserRole": "Owner",
    "MarkedAsAnswerDate": null
  }
]